name: Build IG

on:
  workflow_dispatch:
  release:
    types:
      - created
  push:
    branches:
      - '**'

# The following jobs are equal for all IGs and can be moved to a common composite-action if 'uses'-support is added, see:
# https://github.com/actions/runner/blob/main/docs/adrs/1144-composite-actions.md
jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Build and test with Rake        
        run: |
          sudo apt-get update
          sudo apt-get install ruby-full
          sudo gem install jekyll

      - name: Install modules
        run: npm install -g fsh-sushi

      - name: Setup Java 21
        uses: actions/setup-java@v3
        with:
          java-version: 21
          distribution: adopt

      - name: üì• Download IG Publisher
        run: wget -q https://github.com/HL7/fhir-ig-publisher/releases/latest/download/publisher.jar

      - name: Get the repo name
        id: repo_name
        run: echo "::set-output name=repo::$(echo ${{ github.repository }} | cut -d '/' -f 2)"
        shell: bash

      - name: List path
        run: ls -R ./

      # Builds the HTML page for the IG.
      - name: üèÉ‚Äç‚ôÇÔ∏è Run IG Publisher
        timeout-minutes: 45 # We need a long timeout here
        run : |
              java -Xmx8192m -jar ../publisher.jar  -ig .
              cd .. 

      - uses: actions/checkout@v4
        with:
          repository: hl7ch/ig-release
          path: ig-release

      - name: List path
        run: ls -R ./

#              cd /home/runner/work/${{ steps.repo_name.outputs.repo }}/${{ steps.repo_name.outputs.repo }}
